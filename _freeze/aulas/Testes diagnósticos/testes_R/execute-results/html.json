{
  "hash": "83b0674b11a0c0ab6883c11dc44266bb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Como analisar a qualidade de testes diagnósticos no R?\"\nformat: \n  revealjs:\n    width: 1600\n    height: 900\n    footer: \"\"\n    theme: quartomonothemer.scss\n    slide-number: c/t\n    show-slide-number: all\nincremental: false\ncode-link: true\nbibliography: references.bib\ntitle-slide-attributes:\n    data-background-image: /images/back.jpeg\n    data-background-size: cover\n    data-background-opacity: \"0.3\"\nexecute:\n  echo: true\n---\n\n\n## Contexto do Problema\n\n<br>\n\nUm novo teste diagnóstico para diabetes foi desenvolvido por uma equipe de pesquisadores. Esse teste visa detectar a presença da doença com maior eficiência e menor custo em comparação ao teste de referência, que é o exame de glicemia em jejum. Antes de sua implementação na prática clínica, é necessário avaliar sua acurácia diagnóstica.\n\n\n**Objetivo:** Avaliar a performance do novo teste diagnóstico em relação ao padrão-ouro (exame de glicemia em jejum).\n\n\n## Metodologia\n\n\nForam selecionados 500 indivíduos aleatoriamente em uma unidade de saúde. Cada participante realizou tanto o novo teste diagnóstico quanto o exame de glicemia em jejum.\n\n. . .\n\nOs participantes foram classificados em dois grupos:\n\n- Doença presente: Indivíduos diagnosticados com diabetes pelo exame de glicemia em jejum.\n- Doença ausente: Indivíduos sem diagnóstico de diabetes pelo exame de glicemia em jejum.\n\n. . .\n\nOs resultados do novo teste diagnóstico foram comparados ao exame de glicemia em jejum para determinar a acurácia do teste.\n\n\n## Carregando os pacotes R\n\n<br>\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(\n  rio,          # importa arquivos\n  tidyverse,    # gestão dos dados + gráficos no ggplot2 \n  janitor,      # adiciona números absolutos e porcentagens às tabelas\n  pROC,         # construção da curva ROC\n  epiR,         # cálculo das métricas de avaliação\n  cutpointr     # grafico da curva ROC\n  )\n```\n:::\n\n\n## Carregando os dados\n\n<br>\n\n::: {.cell}\n\n```{.r .cell-code}\ndados = rio::import(\"https://raw.githubusercontent.com/tiagomartin/est104/refs/heads/master/dados/teste_diabetes.csv\") \n\ndados %>% \n  str()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t500 obs. of  4 variables:\n $ V1            : int  1 2 3 4 5 6 7 8 9 10 ...\n $ doenca        : int  0 1 0 1 1 0 0 1 0 0 ...\n $ teste_positivo: int  0 1 0 1 1 0 0 1 0 0 ...\n $ glicemia      : num  73.2 147.8 103.1 110.3 165.7 ...\n```\n\n\n:::\n:::\n\n## Tabela de contingência das variáveis doença e teste positivo\n\n<br>\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\ntabela = table(Referencia = dados$doenca, Teste = dados$teste_positivo)\n  \n# Calculo das métricas\n\nmetr = epi.tests(tabela, method = \"exact\", digits = 2, conf.level = 0.95)\n\nmetr\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          Outcome +    Outcome -      Total\nTest +          278           27        305\nTest -           20          175        195\nTotal           298          202        500\n\nPoint estimates and 95% CIs:\n--------------------------------------------------------------\nApparent prevalence *                  0.61 (0.57, 0.65)\nTrue prevalence *                      0.60 (0.55, 0.64)\nSensitivity *                          0.93 (0.90, 0.96)\nSpecificity *                          0.87 (0.81, 0.91)\nPositive predictive value *            0.91 (0.87, 0.94)\nNegative predictive value *            0.90 (0.85, 0.94)\nPositive likelihood ratio              6.98 (4.91, 9.93)\nNegative likelihood ratio              0.08 (0.05, 0.12)\nFalse T+ proportion for true D- *      0.13 (0.09, 0.19)\nFalse T- proportion for true D+ *      0.07 (0.04, 0.10)\nFalse T+ proportion for T+ *           0.09 (0.06, 0.13)\nFalse T- proportion for T- *           0.10 (0.06, 0.15)\nCorrectly classified proportion *      0.91 (0.88, 0.93)\n--------------------------------------------------------------\n* Exact CIs\n```\n\n\n:::\n:::\n\n## Índice de Youden e *Odds Ratio*\n\n::: {.cell}\n\n```{.r .cell-code}\n# Índice de Youden\n\nmetr$detail[metr$detail$statistic == \"youden\",]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  statistic       est    lower     upper\n8    youden 0.7992225 0.709763 0.8685588\n```\n\n\n:::\n\n```{.r .cell-code}\n# Odds ratio\n\nmetr$detail[metr$detail$statistic == \"diag.or\",]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  statistic      est    lower    upper\n6   diag.or 90.09259 49.03156 165.5398\n```\n\n\n:::\n\n```{.r .cell-code}\n# Qual a proporção de indivíduos descartados como tendo alto risco de diabetes?\n\nmetr$detail[metr$detail$statistic == \"p.rout\",] \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   statistic  est     lower     upper\n13    p.rout 0.39 0.3470083 0.4343004\n```\n\n\n:::\n\n```{.r .cell-code}\n# Qual a proporção de indivíduos considerados de alto risco de diabetes?\n\nmetr$detail[metr$detail$statistic == \"p.rin\",] \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   statistic  est     lower     upper\n14     p.rin 0.61 0.5656996 0.6529917\n```\n\n\n:::\n:::\n\n## Outras métricas\n\n<br>\n<br>\n\n::: {.cell}\n\n```{.r .cell-code}\n# Qual é a proporção de resultados falso-positivos? Ou seja, qual é a proporção de indivíduos com teste positivo entre aqueles que são negativos para a doença?\n\nmetr$detail[metr$detail$statistic == \"p.tpdn\",]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   statistic       est      lower     upper\n15    p.tpdn 0.1336634 0.08996739 0.1884856\n```\n\n\n:::\n\n```{.r .cell-code}\n# Qual é a proporção de resultados falso-negativos? Ou seja, qual é a proporção de indivíduos com teste negativo entre aqueles que são positivos para a doença?\n\nmetr$detail[metr$detail$statistic == \"p.tndp\",]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   statistic        est      lower     upper\n16    p.tndp 0.06711409 0.04147376 0.1017513\n```\n\n\n:::\n:::\n\n\n# E se a variável desfecho for contínua?\n\n## E se a variável desfecho for contínua?\n\n\n\n<br>\n<br>\n\nVamos considerar a variável *Índice de Glicemia* para avaliação do diagnóstico.\n\n<br>\n\n::: {.cell}\n\n```{.r .cell-code}\ndados$glicemia %>% \n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1]  73.24623 147.77336 103.08593 110.34092 165.67191  91.60543\n```\n\n\n:::\n\n```{.r .cell-code}\ndados$glicemia %>% \n  summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  45.75   85.85  101.76  112.68  140.96  190.84 \n```\n\n\n:::\n:::\n\n\n\n\n## Curva ROC e Área Sob a Curva (AUC)\n\n<br>\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nroc_obj = pROC::roc(dados$doenca, dados$glicemia)\nplot(roc_obj, main = \"Curva ROC do Teste Diagnóstico\")\n```\n\n::: {.cell-output-display}\n![](testes_R_files/figure-revealjs/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\n##Área sob a Curva (AUC)\nauc_valor = pROC::auc(roc_obj)\nauc_valor\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nArea under the curve: 0.9901\n```\n\n\n:::\n:::\n\n\n## Escolha do Melhor Ponto de Corte\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncp = cutpointr(dados,  glicemia, doenca, \n                method = maximize_metric, metric = youden)\n\ncp$optimal_cutpoint\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 117.7534\n```\n\n\n:::\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Algumas métricas de avaliação\n\nsummary(cp)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMethod: maximize_metric \nPredictor: glicemia \nOutcome: doenca \nDirection: >= \n\n    AUC   n n_pos n_neg\n 0.9901 500   195   305\n\n optimal_cutpoint youden   acc sensitivity specificity  tp fn fp  tn\n         117.7534 0.9164 0.958       0.959      0.9574 187  8 13 292\n\nPredictor summary: \n    Data     Min.        5%   1st Qu.    Median      Mean   3rd Qu.      95%\n Overall 45.75192  69.90402  85.84629 101.76185 112.67595 140.95893 170.6583\n       0 45.75192  66.15261  80.00629  88.80496  89.59556  98.61755 116.4540\n       1 93.02906 119.23256 137.15388 148.79227 148.77605 162.67633 177.8412\n     Max.       SD NAs\n 190.8391 33.28575   0\n 141.3164 15.06062   0\n 190.8391 18.62637   0\n```\n\n\n:::\n:::\n\n## Curva ROC\n\n::: {.cell}\n\n```{.r .cell-code}\n## Curva roc\n\nplot(cp)\n```\n\n::: {.cell-output-display}\n![](testes_R_files/figure-revealjs/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n\n## Métricas de avaliação\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\ndados$teste_cont = ifelse(dados$glicemia >= cp$optimal_cutpoint, 1, 0)\n\ntabela_cont = table(Referencia = dados$doenca, Teste = dados$teste_cont)\n  \n# Calculo das métricas\n\nmetr_cont = epi.tests(tabela_cont, method = \"exact\", digits = 2, conf.level = 0.95)\n\nmetr_cont\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          Outcome +    Outcome -      Total\nTest +          292           13        305\nTest -            8          187        195\nTotal           300          200        500\n\nPoint estimates and 95% CIs:\n--------------------------------------------------------------\nApparent prevalence *                  0.61 (0.57, 0.65)\nTrue prevalence *                      0.60 (0.56, 0.64)\nSensitivity *                          0.97 (0.95, 0.99)\nSpecificity *                          0.94 (0.89, 0.96)\nPositive predictive value *            0.96 (0.93, 0.98)\nNegative predictive value *            0.96 (0.92, 0.98)\nPositive likelihood ratio              14.97 (8.85, 25.34)\nNegative likelihood ratio              0.03 (0.01, 0.06)\nFalse T+ proportion for true D- *      0.06 (0.04, 0.11)\nFalse T- proportion for true D+ *      0.03 (0.01, 0.05)\nFalse T+ proportion for T+ *           0.04 (0.02, 0.07)\nFalse T- proportion for T- *           0.04 (0.02, 0.08)\nCorrectly classified proportion *      0.96 (0.94, 0.97)\n--------------------------------------------------------------\n* Exact CIs\n```\n\n\n:::\n:::\n\n\n## Outras métricas\n\n::: {.cell}\n\n```{.r .cell-code}\nmetr_cont$detail\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   statistic          est        lower        upper\n1         ap   0.61000000   0.56569956 6.529917e-01\n2         tp   0.60000000   0.55557180 6.432386e-01\n3         se   0.97333333   0.94813419 9.884184e-01\n4         sp   0.93500000   0.89141276 9.649393e-01\n5    diag.ac   0.95800000   0.93651306 9.738164e-01\n6    diag.or 525.03846154 213.53856757 1.290940e+03\n7       nndx   1.10091743   1.04892421 1.191119e+00\n8     youden   0.90833333   0.83954695 9.533577e-01\n9     pv.pos   0.95737705   0.92821625 9.771129e-01\n10    pv.neg   0.95897436   0.92076612 9.821242e-01\n11    lr.pos  14.97435897   8.84960849 2.533801e+01\n12    lr.neg   0.02852050   0.01438228 5.655701e-02\n13    p.rout   0.39000000   0.34700826 4.343004e-01\n14     p.rin   0.61000000   0.56569956 6.529917e-01\n15    p.tpdn   0.06500000   0.03506071 1.085872e-01\n16    p.tndp   0.02666667   0.01158157 5.186581e-02\n17    p.dntp   0.04262295   0.02288708 7.178375e-02\n18    p.dptn   0.04102564   0.01787576 7.923388e-02\n```\n\n\n:::\n:::\n\n",
    "supporting": [
      "testes_R_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}