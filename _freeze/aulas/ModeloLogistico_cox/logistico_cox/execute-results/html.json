{
  "hash": "eae4195be4eb179279341c42296118a5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Modelo de regressão logística e Modelos de risco proporcionais (Cox)\"\nformat: \n  revealjs:\n    width: 1600\n    height: 900\n    footer: \"\"\n    theme: quartomonothemer.scss\n    slide-number: c/t\n    show-slide-number: all\nincremental: false\ncode-link: true\nbibliography: references.bib\ntitle-slide-attributes:\n    data-background-image: /images/back.jpeg\n    data-background-size: cover\n    data-background-opacity: \"0.3\"\nexecute:\n  echo: true\n---\n\n# Modelos prognósticos\n\n\n## Modelos prognósticos\n\n**Prognóstico** significa prever, predizer ou estimar a probabilidade ou  risco de **condições futuras**.\n\n\n. . .\n\n\nNa área da saúde, prognóstico comumente relaciona-se à probabilidade ou risco de um **indivíduo** desenvolver um particular estado de saúde (um desfecho) ao longo de um período de tempo específico, baseado na presença ou ausência de um perfil clínico.\n\n\n. . .\n\n\n**Regressão linear**, **logística** e **de risco** (análise de sobrevida) são métodos comuns utilizados na pesquisa clínica para relatar covariáveis e desfechos.\n\n\n## Modelos prognósticos\n\nA **regressão linear** é o método padrão para **desfechos contínuos**.\n\n. . .\n\nA **regressão logística** é adequada para **desfechos binários**\n\n. . .\n\nQuando desfechos binários são medidos **prospectivamente**, eles também são associados com um tempo para o evento. Neste caso, a **regressão logística** ou a **análise de sobrevida** podem ser adequadas.\n\n\n\n## Modelos de regressão linear\n\n\nNa regressão linear, ajustamos um modelo do tipo\n\n\n$$Y = \\beta_0 + \\beta_1X_1+ \\dots + \\beta_iX_i + \\varepsilon$$\n\n. . .\n\n\n- **Pressuposto importante:** a variável $Y$ era de natureza **contínua** e seguia uma distribuição normal.\n\n\n\n. . .\n\n\nO modelo se preocupava em estimar (ou predizer) o valor médio de $Y$ dado um certo conjunto de valores das variáveis explicativas.\n\n\n\n\n## Modelos de regressão linear\n\n\nEm um modelo de regressão linear, as variáveis explicativas podem ser **contínuas** ou **dicotômicas**.\n\n. . .\n\nO **coeficiente** para uma covariável contínua depende, em grande parte, das unidades, e a **magnitude** só pode ser interpretada em um **contexto clínico**.\n\n. . .\n\nSe um pesquisador quer saber a **mudança esperada na resposta** para um aumento de 10 unidades (ou qualquer outro aumento) em uma covariável contínua, ele pode simplesmente multiplicar o coeficiente (e os limites de confiança) por 10. \n\n\n. . .\n\nPara covariáveis **dicotômicas**, o coeficiente é interpretado como a **diferença na resposta** que seria vista, em média, entre os dois níveis da covariável.\n\n\n# Exemplo \n\n## Descrição da base de dados\n\n\nO [NHANES](https://www.cdc.gov/nchs/nhanes/index.html) (National Health and Nutrition Examination Survey) é um estudo populacional dos EUA que contém dados de saúde.\n\n. . .\n\nVamos estimar um modelo de regressão linear múltiplo usando os dados do NHANES, incluindo covariáveis clínicas e demográficas.\n\n\n\n\n## Descrição da base de dados\n\nUsaremos a pressão arterial sistólica (PAS) como variável dependente e as seguintes variáveis independentes:\n\n- IMC (quanto maior o IMC, maior pode ser a pressão arterial?)\n- Idade (o envelhecimento está associado ao aumento da PAS?)\n- Sexo (homens têm maior PAS que mulheres?)\n- Horas de sono à noite (SleepHrsNight) (dormir mais pode diminuir a PAS?)\n- Nível de colesterol total (TotChol) (colesterol elevado está associado a maior PAS?)\n- Tabagismo (SmokeNow) (fumantes têm PAS mais alta?)\n\n\n\n## Preparação\n\n\n### Carregando os pacotes R\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(\nNHANES,\ntidyverse,\ncar,\nlmtest,\nmfx\n  ) \n```\n:::\n\n## Carregando os dados\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Selecionar variáveis relevantes e remover NAs\ndados <- NHANES %>%\n  filter(!is.na(BPSysAve) & !is.na(BMI) & !is.na(Age) & !is.na(Gender) & \n           !is.na(TotChol) & !is.na(SleepHrsNight) & !is.na(SmokeNow)) %>%\n  dplyr::select(BPSysAve, BMI, Age, Gender, TotChol,SleepHrsNight,  SmokeNow)\n```\n:::\n\n\n## Manipulação dos dados\n\n::: {.cell}\n\n```{.r .cell-code}\n# Renomear variáveis para facilitar\ncolnames(dados) <- c(\"PAS\", \"IMC\", \"Idade\", \"Sexo\", \"Colesterol\", \"HorasDeSonoNoite\", \"Fumante\")\n\n# Transformar Sexo e Fumante em fatores\ndados$Sexo <- as.factor(dados$Sexo)\ndados$Fumante <- as.factor(dados$Fumante)\n\n# Estrutura dos dados\n\ndados %>% \n  str()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [2,940 × 7] (S3: tbl_df/tbl/data.frame)\n $ PAS             : int [1:2940] 113 113 113 112 111 127 128 152 122 144 ...\n $ IMC             : num [1:2940] 32.2 32.2 32.2 30.6 23.7 ...\n $ Idade           : int [1:2940] 34 34 34 49 66 58 33 60 57 44 ...\n $ Sexo            : Factor w/ 2 levels \"female\",\"male\": 2 2 2 1 2 1 2 2 1 2 ...\n $ Colesterol      : num [1:2940] 3.49 3.49 3.49 6.7 4.99 4.78 5.59 6.39 5.04 5.61 ...\n $ HorasDeSonoNoite: int [1:2940] 4 4 4 8 7 5 6 6 8 4 ...\n $ Fumante         : Factor w/ 2 levels \"No\",\"Yes\": 1 1 1 2 1 2 1 1 1 2 ...\n```\n\n\n:::\n:::\n\n\n## Ajuste do modelo\n\n::: {.cell}\n\n```{.r .cell-code}\n# Ajustar modelo de regressão linear múltiplo\nmodelo_multiplo <- lm(PAS ~ IMC + Idade + Sexo + Colesterol + HorasDeSonoNoite + Fumante, data = dados)\n\n# Resumo do modelo\nsummary(modelo_multiplo)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = PAS ~ IMC + Idade + Sexo + Colesterol + HorasDeSonoNoite + \n    Fumante, data = dados)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-56.440  -9.003  -1.070   8.170  83.997 \n\nCoefficients:\n                 Estimate Std. Error t value Pr(>|t|)    \n(Intercept)      88.82356    2.63293  33.736  < 2e-16 ***\nIMC               0.17376    0.04634   3.750 0.000181 ***\nIdade             0.42727    0.01868  22.876  < 2e-16 ***\nSexomale          4.91074    0.59226   8.292  < 2e-16 ***\nColesterol        1.46760    0.27216   5.392  7.5e-08 ***\nHorasDeSonoNoite -0.42090    0.21150  -1.990 0.046674 *  \nFumanteYes        0.63493    0.62894   1.010 0.312811    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 15.86 on 2933 degrees of freedom\nMultiple R-squared:  0.1956,\tAdjusted R-squared:  0.194 \nF-statistic: 118.9 on 6 and 2933 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n\n## Interpretação do modelo\n\n```{=html}\n<html lang=\"pt\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\n\n    <!-- Link da fonte está na descrição -->\n    <link href=\"https://fonts.googleapis.com/css?family=Montserrat:wght@500&display=swap\" \n    rel=\"stylesheet\"> \n\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n<table class=\"table table-striped\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<thead>\n<tr>\n</tr>\n\n<tr>\n<th style=\"text-align:center;font-weight: bold;font-size:30px;\">\nVariável\n</th>\n<th style=\"text-align:center;font-weight: bold;font-size:30px;\">\nCoeficiente (&beta;)\n</th>\n<th style=\"text-align:center;font-weight: bold;font-size:30px;\">\np-valor\n</th>\n<th style=\"text-align:center;font-weight: bold;font-size:30px;\">\nInterpretação\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center;font-size:30px;\">\nIntercepto\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n88,82\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n< 0,001\n</td>\n<td style=\"text-align:center;font-size:30px;\">\nValor médio da PAS quando todas as variáveis preditoras são zero.\n</td>\n</tr>\n<tr>\n<td style=\"text-align:center;font-size:30px;\">\nIMC\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n0,17\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n< 0,001\n</td>\n<td style=\"text-align:center;font-size:30px;\">\nA cada aumento de 1 unidade no IMC, a PAS aumenta, em média, 0,17 mmHg, ajustado para as demais variáveis.\n</td>\n</tr>\n<tr>\n<td style=\"text-align:center;font-size:30px;\">\nIdade\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n0,42\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n< 0,001\n</td>\n<td style=\"text-align:center;font-size:30px;\">\nA cada ano a mais de idade, a PAS aumenta 0.42 mmHg.\n</td>\n</tr>\n<tr>\n<td style=\"text-align:center;font-size:30px;\">\nSexo (Masculino)\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n4,91\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n< 0,001\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n O sexo masculino foi associado a uma PAS 4,91 mmHg maior que no sexo feminino, em média.\n</td>\n</tr>\n<tr>\n<td style=\"text-align:center;font-size:30px;\">\nColesterol\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n1,47\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n< 0,001\n</td>\n<td style=\"text-align:center;font-size:30px;\">\nPara cada aumento de 1 mg/dL no colesterol, a PAS aumenta 1,47 mmHg.\n</td>\n</tr>\n<tr>\n<td style=\"text-align:center;font-size:30px;\">\nHoras de sono\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n-0,42\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n0,047\n</td>\n<td style=\"text-align:center;font-size:30px;\">\nPara cada aumento de 1 h dormida a noite, a PAS diminui 0,42 mmHg.\n</td>\n</tr>\n<tr>\n<td style=\"text-align:center;font-size:30px;\">\nFumante (Sim)\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n0,64\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n0,312\n</td>\n<td style=\"text-align:center;font-size:30px;\">\nNão significativo (p > 0.05), indicando que o tabagismo não teve efeito estatisticamente relevante na PAS.\n</td>\n</tr>\n<tr>\n</tr>\n</tbody>\n</table>\n</body>\n</html>\n```\n\n\n\n\n## Variável dependente (desfecho) binária\n\n\nE se a variável dependente $y$ for **binária**?\n\n- Doença (presente = 1/ausente = 0)\n- Morto = 1/Vivo = 0\n\n\n. . .\n\nAqui, $Y = 1$ corresponde ao sucesso, ou seja, a ocorrência do evento e $Y = 0$ corresponde ao fracasso, ou seja, à não ocorrência do evento.\n\n\n. . .\n\n\nTemos então que a média de $Y$ é igual a $p$, sendo $p$ a proporção de vezes que $Y$ assume o valor 1. Assim, \n\n$$p = P(Y=1) = P(\\text{sucesso})$$\n\n## Variável dependente (desfecho) binária\n\n\nA regressão logística é um modelo estatístico que permite estimar a probabilidade $p$ da ocorrência de um determinado desfecho categórico (Y) em função de um ou mais preditores (X), que podem ser contínuos ou categóricos. \n\n\n\n\n. . .\n\n\nVamos a um exemplo...\n\n\n\n## Variável dependente (desfecho) binária\n\nConsidere a população de bebês com baixo peso ao nascer (definido como < 1750g) que estão confinados em uma unidade de tratamento intensivo neonatal, entubados durante as primeiras 12 semanas de vida e sobreviventes por, no mínimo, 28 dias. \n\n\nNa amostra de 223 bebês extraída da população original, 76 foram diagnosticados com *displasia broncopulmonar* (BPD). Os restantes 147 não tinham a doença.\n\n\nSeja $Y$ uma variável aleatória dicotômica, de forma que\n\n\n$$Y = \\begin{cases} 0 & \\text{Ausência de BPD} \\\\ 1 & \\text{Presença de BPD} \\end{cases}$$\n\n\n## Variável dependente (desfecho) binária\n\nA probabilidade estimada de que um bebê dessa população desenvolva BPD é a **proporção amostral** de bebês com BPD, ou seja,\n\n$$\\hat{p} = \\dfrac{76}{223} = 0,341$$\n\n\n. . .\n\n\nPodemos suspeitar que alguns fatores, maternos ou neonatais, devem afetar a probabilidade de um bebê em particular desenvolver BPD.\n\n\n. . .\n\n\nO conhecimento da presença ou ausência desses fatores pode:\n\n- aumentar a precisão de nossa estimativa de $p$,\n\n- desenvolverintervenções para reduzir essa probabilidade.\n\n\n\n\n\n\n## Variável dependente (desfecho) binária\n\n\n- Um fator interessante poderia ser o peso de nascimento de um bebê, que chamaremos de $X$.\n\n\n. . .\n\n\n- Se a variável $Y$ fosse **contínua**, poderíamos começar a análise contruindo um diagrama de dispersão entre as variáveis $X$ e $Y$.\n\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n::: {.r-stack}\n![](/images/BPD_disp.png){.fragment width=\"600\" height=\"450\"}\n\n![](/images/BPD_disp2.png){.fragment width=\"600\" height=\"450\"}\n:::\n:::\n\n::: {.column width=\"50%\" .fragment}\n\n```{=html}\n<html lang=\"pt\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\n\n    <!-- Link da fonte está na descrição -->\n    <link href=\"https://fonts.googleapis.com/css?family=Montserrat:wght@500&display=swap\" \n    rel=\"stylesheet\"> \n\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n<table class=\"table table-striped\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<thead>\n<tr>\n<th>\n<div style=\"border-bottom: 3px; padding-bottom: 5px;\">\n</div>\n</th>\n</tr>\n<tr>\n<th style=\"text-align:center;font-weight: bold;font-size:30px;\">\nPeso(g)\n</th>\n<th style=\"text-align:center;font-weight: bold;font-size:30px;\">\nn\n</th>\n<th style=\"text-align:center;font-weight: bold;font-size:30px;\">\nBPD \n</th>\n<th style=\"text-align:center;font-weight: bold;font-size:30px;\">\np\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center;font-weight: bold;font-size:30px;\">\n0-950\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n68\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n49\n</td>\n<td style=\"text-align:center;font-weight: bold;font-size:30px;\">\n0,721\n</td>\n</tr>\n<tr>\n<td style=\"text-align:center;font-weight: bold;font-size:30px;\">\n951-1350\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n80\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n18\n</td>\n<td style=\"text-align:center;font-weight: bold;font-size:30px;\">\n0,225\n</td>\n</tr>\n<tr>\n<td style=\"text-align:center;font-weight: bold;font-weight: bold;font-size:30px;\">\n1351-1750\n</td>\n<td style=\"text-align:center;font-weight: bold;font-size:30px;\">\n75\n</td>\n<td style=\"text-align:center;font-weight: bold;font-size:30px;\">\n9\n</td>\n<td style=\"text-align:center;font-weight: bold;font-weight: bold;font-size:30px;\">\n0,120\n</td>\n</tr>\n<tr>\n<td style=\"text-align:center;font-weight: bold;font-weight: bold;font-size:30px;\">\n</td>\n<td style=\"text-align:center;font-weight: bold;font-size:30px;\">\n223\n</td>\n<td style=\"text-align:center;font-weight: bold;font-size:30px;\">\n76\n</td>\n<td style=\"text-align:center;font-weight: bold;font-weight: bold;font-size:30px;\">\n0,341\n</td>\n</tr>\n<tr>\n<th>\n<div style=\"border-bottom: 3px; padding-bottom: 5px;\">\n</div>\n</th>\n</tr>\n</tbody>\n</table>\n</body>\n</html>\n```\n\n:::\n\n::::\n\n\n\n## Variável dependente (desfecho) binária\n\n\n- Parece que a probabilidade de desenvolver BPD aumenta à medida que o peso do bebê ao nascer diminui e vice-versa.\n\n\n. . .\n\n\n- Como parece haver uma relação entre estas duas variáveis, podemos usar o peso ao nascer de uma criança para nos ajudar a prever a probabilidade de que ela desenvolva BPD.\n\n\n\n## Função logística\n\nA primeira estratégia poderia ser ajustar um modelo da forma\n\n$$p = \\beta_0 + \\beta_1 x$$\nonde $x$ representa o peso ao nascer. \n\n\n. . .\n\n\nSob inspeção, este modelo não é viável, uma vez que $p$ é uma probabilidade, podendo assumir, portanto, valores entre 0 e 1.\n\n. . .\n\n\nO termo $\\beta_0 + \\beta_1 x$, ao contrário, pode assumir valores fora desse intervalo.\n\n\n\n\n## Função logística\n\n\nUma alternativa seria ajustar o modelo\n\n\n\n$$p = e^{\\beta_0 + \\beta_1 x}$$\n\n\nEssa expressão garante que a estimativa de $p$ é sempre positiva.\n\n\n. . .\n\n\nNo entanto, este modelo também é inadequado, uma vez que pode produzir valores maiores que 1.\n\n\n## Função logística\n\nPodemos então, ajustar um modelo da forma\n\n$$p = \\dfrac{e^{\\beta_0 + \\beta_1 x}}{1 + e^{\\beta_0 + \\beta_1 x}}$$\n\n\n. . .\n\nEsta expressão, conhecida como **função logística**, não admite valores negativos nem maiores que 1.\n\n\n\n## Função logística\n\n\nLembre-se de que, se um evento ocorre com probabilidade $p$, a **chance** a seu favor é de $\\dfrac{p}{1-p}$ para 1.\n\n. . .\n\nAssim, se um **sucesso** ocorre com probabilidade\n\n\n$$p = \\dfrac{e^{\\beta_0 + \\beta_1 x}}{1 + e^{\\beta_0 + \\beta_1 x}},$$\n\n## Função logística\n\n\na **chance** em favor de sucesso é\n\n\n$$\\dfrac{p}{1-p} = \\dfrac{\\dfrac{e^{\\beta_0 + \\beta_1 x}}{1 + e^{\\beta_0 + \\beta_1 x}}}{\\dfrac{1}{1 + e^{\\beta_0 + \\beta_1 x}}} = e^{\\beta_0 + \\beta_1 x}$$\n\n. . .\n\n\nTomando o logaritmo natural de cada lado dessa equação,\n\n\n$$\\underbrace{\\ln\\left ( \\frac{p}{1-p} \\right)}_\\text{logit} = \\ln(e^{\\beta_0 + \\beta_1 x}) = \\beta_0 + \\beta_1 x$$\n\n\n\n## Modelo de regressão logística\n\n\nModelar uma probabilidade $p$ com uma função logística é **equivalente** a ajustar um modelo de regressão linear onde a variável dependente contínua $y$ foi substituída pelo logaritmo neperiano da **chance** de ocorrência de um evento **dicotômico**.\n\n. . .\n\n\nEm vez de assumir que a relação entre $p$ e $X$ é **linear**, assume-se que a relação entre $\\ln\\left ( \\frac{p}{1-p} \\right)$ e $X$ é **linear**.\n\n\n. . .\n\nEssa técnica é conhecida como **regressão logística**.\n\n\n## Modelo de regressão logística\n\nOs parâmetros do modelo ($\\beta$'s) são estimados usando o **método de máxima verossimilhança**, que busca maximizar a probabilidade de observar os dados dados os parâmetros. \n\n. . .\n\nEste processo envolve iterativamente ajustar os coeficientes para melhor se alinhar com os dados observados.\n\n\n$$\\ln\\left ( \\frac{\\hat{p}}{1-\\hat{p}} \\right) = \\hat{\\beta}_0 + \\hat{\\beta}_1 x$$\n\n\n## Modelo de regressão logística\n\nVoltando ao exemplo, para a amostra de 223 bebês com baixo peso ao nascer, a equação da regressão logística estimada é\n\n$$\\ln\\left ( \\frac{\\hat{p}}{1-\\hat{p}} \\right) = 4,0343 - 0,0042 x$$\n\n. . .\n\n\n- **Interpretação:** O coeficiente do peso indica que, para cada aumento de 1 grama no peso ao nascer, o logaritmo da chance de que um bebê desenvolva BPD diminui de 0,0042, em média.\n\n\n\n## Modelo de regressão logística\n\n\nQual a probabilidade de que um bebê, retirado desta população pesando 750g ao nascer, irá desenvolver BPD?\n\n\n$$\n\\begin{eqnarray*}\n\\ln\\left ( \\frac{\\hat{p}}{1-\\hat{p}} \\right) = 4,0343 - 0,0042 x\n\\end{eqnarray*}\n$$\n\n. . .\n\n\n\nTrocando-se $x$ por 750, temos\n\n$$\n\\begin{eqnarray*}\n\\ln\\left ( \\frac{\\hat{p}}{1-\\hat{p}} \\right) = 4,0343 - 0,0042 \\times 750 = 0,8843\n\\end{eqnarray*}\n$$\n\n\n## Modelo de regressão logística\n\n\nAplicando a função exponencial em ambos os lados, temos\n\n$$\n\\begin{eqnarray*}\n\\ln\\left ( \\frac{\\hat{p}}{1-\\hat{p}} \\right) &=& 0,8843 \\\\ \\frac{\\hat{p}}{1-\\hat{p}} &=& e^{0,8843} = 2,4113\n\\end{eqnarray*}\n$$\n\n\n## Modelo de regressão logística\n\n\nIsolando $\\hat{p}$:\n\n$$\n\\begin{eqnarray*}\n\\frac{\\hat{p}}{1-\\hat{p}} &=& 2,4113 \\\\ \\hat{p} &=& 2,4113 - 2,4113 \\hat{p} \\\\ \\hat{p} + 2,4113 \\hat{p} &=& 2,4113 \\\\ (1 + 2,4113)\\hat{p} &=& 2,4113 \\\\ \\hat{p} &=& \\dfrac{2,4113}{1 + 2,4113} = 0,708\n\\end{eqnarray*}\n$$\n\n\n\n\n## Modelo de regressão logística\n\n\nA probabilidade estimada de que uma criança, que pesa 750g ao nascer, desenvolva BPD é de 0,708.\n\n. . .\n\nSe calculássemos a probabilidade estimada $\\hat{p}$ para cada valor observado dos pesos ao nascer e plotássemos $\\hat{p} \\times$ o peso, teríamos\n\n\n![](/images/graf_logs.png){.fragment width=\"600\" height=\"450\" fig-align=\"center\"}\n\n\n\n\n# Exemplo \n\n## Descrição da base de dados\n\n\nO [NHANES](https://www.cdc.gov/nchs/nhanes/index.html) (National Health and Nutrition Examination Survey) é um estudo populacional dos EUA que contém dados de saúde.\n\n. . .\n\nVamos estimar um modelo de regressão logística usando os dados do NHANES, incluindo covariáveis clínicas e demográficas.\n\n   \n\n\n## Descrição da base de dados\n\nUsaremos *Diabetes* como variável dependente e as seguintes variáveis independentes:\n\n- PAS (a pressão arterial sistólica está associada à diabetes?)\n- IMC (IMC está associado à diabetes?)\n- Idade (o envelhecimento está associado à diabetes?)\n- Sexo (homens têm maior risco de ter diabetes que mulheres?)\n- Horas de sono à noite (SleepHrsNight) (dormir mais influencia no fato de ter diabetes?)\n- Nível de colesterol total (TotChol) (colesterol elevado está associado à diabetes?)\n- Tabagismo (SmokeNow) (fumantes têm maior risco de ter diabetes?)\n\n\n\n## Preparação\n\n\n### Carregando os pacotes R\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(\nNHANES,\ntidyverse,\ncar,\nlmtest\n  ) \n```\n:::\n\n## Carregando os dados\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Selecionar variáveis relevantes e remover NAs\ndados <- NHANES %>%\n  filter(!is.na(BPSysAve) & !is.na(BMI) & !is.na(Age) & !is.na(Gender) & \n           !is.na(TotChol) & !is.na(SleepHrsNight) & !is.na(SmokeNow) & !is.na(Diabetes)) %>%\n  dplyr::select(BPSysAve, BMI, Age, Gender, TotChol,SleepHrsNight,  SmokeNow, Diabetes)\n```\n:::\n\n\n## Manipulação dos dados\n\n::: {.cell}\n\n```{.r .cell-code}\n# Renomear variáveis para facilitar\ncolnames(dados) <- c(\"PAS\", \"IMC\", \"Idade\", \"Sexo\", \"Colesterol\", \"HorasDeSonoNoite\", \"Fumante\", \"Diabetes\")\n\n# Transformar Sexo e Fumante em fatores\ndados$Sexo <- as.factor(dados$Sexo)\ndados$Fumante <- as.factor(dados$Fumante)\ndados$Diabetes <- as.factor(dados$Diabetes)\n\n# Estrutura dos dados\n\ndados %>% \n  str()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [2,938 × 8] (S3: tbl_df/tbl/data.frame)\n $ PAS             : int [1:2938] 113 113 113 112 111 127 128 152 122 144 ...\n $ IMC             : num [1:2938] 32.2 32.2 32.2 30.6 23.7 ...\n $ Idade           : int [1:2938] 34 34 34 49 66 58 33 60 57 44 ...\n $ Sexo            : Factor w/ 2 levels \"female\",\"male\": 2 2 2 1 2 1 2 2 1 2 ...\n $ Colesterol      : num [1:2938] 3.49 3.49 3.49 6.7 4.99 4.78 5.59 6.39 5.04 5.61 ...\n $ HorasDeSonoNoite: int [1:2938] 4 4 4 8 7 5 6 6 8 4 ...\n $ Fumante         : Factor w/ 2 levels \"No\",\"Yes\": 1 1 1 2 1 2 1 1 1 2 ...\n $ Diabetes        : Factor w/ 2 levels \"No\",\"Yes\": 1 1 1 1 1 1 1 1 1 2 ...\n```\n\n\n:::\n:::\n\n\n## Ajuste do modelo\n\n::: {.cell}\n\n```{.r .cell-code}\n# Ajustar modelo de regressão logistica\nmodelo_logistico <- glm(Diabetes ~ ., data = dados, family = binomial(link='logit'))\n\n# Resumo do modelo\nsummary(modelo_logistico)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = Diabetes ~ ., family = binomial(link = \"logit\"), \n    data = dados)\n\nCoefficients:\n                  Estimate Std. Error z value Pr(>|z|)    \n(Intercept)      -7.746757   0.721204 -10.741  < 2e-16 ***\nPAS               0.003845   0.003409   1.128  0.25925    \nIMC               0.104682   0.009341  11.206  < 2e-16 ***\nIdade             0.051445   0.004731  10.874  < 2e-16 ***\nSexomale          0.317999   0.131212   2.424  0.01537 *  \nColesterol       -0.198636   0.061478  -3.231  0.00123 ** \nHorasDeSonoNoite  0.023144   0.045036   0.514  0.60733    \nFumanteYes       -0.183802   0.145628  -1.262  0.20690    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 2101.4  on 2937  degrees of freedom\nResidual deviance: 1734.2  on 2930  degrees of freedom\nAIC: 1750.2\n\nNumber of Fisher Scoring iterations: 6\n```\n\n\n:::\n:::\n\n## Avaliando *odds ratio*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlogitor(Diabetes ~., data=dados)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\nlogitor(formula = Diabetes ~ ., data = dados)\n\nOdds Ratio:\n                 OddsRatio Std. Err.       z     P>|z|    \nPAS              1.0038527 0.0034216  1.1282  0.259253    \nIMC              1.1103572 0.0103724 11.2061 < 2.2e-16 ***\nIdade            1.0527909 0.0049805 10.8744 < 2.2e-16 ***\nSexomale         1.3743748 0.1803346  2.4235  0.015370 *  \nColesterol       0.8198486 0.0504025 -3.2310  0.001234 ** \nHorasDeSonoNoite 1.0234136 0.0460907  0.5139  0.607328    \nFumanteYes       0.8321009 0.1211769 -1.2621  0.206900    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n## Interpretação do modelo\n\n```{=html}\n<html lang=\"pt\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\n\n    <!-- Link da fonte está na descrição -->\n    <link href=\"https://fonts.googleapis.com/css?family=Montserrat:wght@500&display=swap\" \n    rel=\"stylesheet\"> \n\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n<table class=\"table table-striped\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<thead>\n<tr>\n</tr>\n\n<tr>\n<th style=\"text-align:center;font-weight: bold;font-size:30px;\">\nVariável\n</th>\n<th style=\"text-align:center;font-weight: bold;font-size:30px;\">\nOddsRatio\n</th>\n<th style=\"text-align:center;font-weight: bold;font-size:30px;\">\np-valor\n</th>\n<th style=\"text-align:center;font-weight: bold;font-size:30px;\">\nInterpretação\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center;font-size:30px;\">\nPAS\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n1,004\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n0,259\n</td>\n<td style=\"text-align:center;font-size:30px;\">\nNão significativo (p-valor > 0,05) indicando que a PAS não teve efeito estatisticamente relevante no fato de ter diabetes.\n</td>\n</tr>\n<tr>\n<td style=\"text-align:center;font-size:30px;\">\nIMC\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n1,110\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n< 0,001\n</td>\n<td style=\"text-align:center;font-size:30px;\">\nA cada aumento de 1 unidade no IMC, a chace do paciente ter diabetes aumenta em 11%, mantendo as outras  variáveis constantes.\n</td>\n</tr>\n<tr>\n<td style=\"text-align:center;font-size:30px;\">\nIdade\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n1,05\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n< 0,001\n</td>\n<td style=\"text-align:center;font-size:30px;\">\nA cada ano a mais de idade, a chace do paciente ter diabetes aumenta em 5%, mantendo as outras  variáveis constantes.\n</td>\n</tr>\n<tr>\n<td style=\"text-align:center;font-size:30px;\">\nSexo (Masculino)\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n1,37\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n< 0,015\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n A chance de um paciente do sexo masculino ter diabetes é 37% maior que do sexo feminino.\n</td>\n</tr>\n<tr>\n<td style=\"text-align:center;font-size:30px;\">\nColesterol\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n0,82\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n0,001\n</td>\n<td style=\"text-align:center;font-size:30px;\">\nPara cada aumento de 1 mg/dL no colesterol, a chace do paciente ter diabetes diminui em 18%, mantendo as outras  variáveis constantes.\n</td>\n</tr>\n<tr>\n<td style=\"text-align:center;font-size:30px;\">\nHoras de sono\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n1,02\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n0,607\n</td>\n<td style=\"text-align:center;font-size:30px;\">\nNão significativo (p > 0.05), indicando que o horas de sonoo não teve efeito estatisticamente relevante no fato do paciente ter diabetes.\n</td>\n</tr>\n<tr>\n<td style=\"text-align:center;font-size:30px;\">\nFumante (Sim)\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n0,83\n</td>\n<td style=\"text-align:center;font-size:30px;\">\n0,207\n</td>\n<td style=\"text-align:center;font-size:30px;\">\nNão significativo (p > 0.05), indicando que o tabagismo não teve efeito estatisticamente relevante no fato do paciente ter diabetes.\n</td>\n</tr>\n<tr>\n</tr>\n</tbody>\n</table>\n</body>\n</html>\n```\n\n\n# Modelo de riscos proporcionais (Cox)\n\n## Análise de sobrevivência\n\nQuando desfechos são associados com **tempo até o evento**, não estamos limitados a estudar um **ponto específico no tempo**, como é feito em estudos transversais.\n\n\n. . .\n\n\nEm vez disso, podemos estar interessados em saber se a probabilidade do evento tende a ser maior (ou menor) ao **longo de todo período de acompanhamento**.\n\n\n. . .\n\nA **análise de sobrevivência** é utilizada para responder essa questão mais ampla.\n\n\n. . .\n\n\nEm estudos de análise de sobrevivência, o problema-chave é o dado considerado **censurado**, ou seja, quando o evento (desfecho) **não ocorreu** quer seja porque o estudo terminou antes da ocorrência do desfecho ou porque se perdeu o acompanhamento do caso.\n\n\n\n## Análise de sobrevivência\n\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n**Dados censurados**\n\n![](/images/censura.png){width=\"600\" height=\"450\" fig-align=\"center\"}\n:::\n\n::: {.column width=\"50%\" .fragment}\n\n**Dados censurados à direita:** maioria\n\n![](/images/censura_direita.png){fig-align=\"center\"}\n\n:::\n\n::::\n\n\n\n## Análise de sobrevivência\n\n\nIndicada para estudos longitudinais (coorte, ensaios clínicos), ou seja, o mesmo grupo de indivíduos é acompanhado durante um **intervalo de tempo** preestabelecido pelo pesquisador.\n\n\n. . .\n\n\nA **grande vantagem** nesse tipo de análise é que se permite utilizar informações de **todos** os participantes até o momento da ocorrência do evento ou quando são censurados.\n\n\n\n## Regressão de riscos \n\nO modelo de sobrevida mais comum é o **modelo de riscos proporcionais de Cox**. Este modelo permite que as covariáveis, numéricas ou categóricas, variem com o tempo.\n\n\n\n\n. . .\n\n\nAssume-se, nesse modelo, que os tempos $t_i$, $i = 1, \\cdots , n$, são independentes e que a taxa de falha (risco) tem a seguinte forma:\n\n\n$$\\lambda(t) = \\lambda_0(t) \\exp (\\beta_1 X_1 + \\cdots + \\beta_pX_p)$$\n\n\n. . .\n\n\nO componente não-paramétrico, $\\lambda_0(t)$, não é especificado e é uma função não-negativa do tempo. Ele é usualmente chamado de função de base ou risco basal.\n\n\n\n## Regressão de riscos \n\nO componente paramétrico $\\exp(\\mathbf{x^t \\beta})$ é o nosso interesse, em especial no vetor de parâmetros $\\mathbf{\\beta}$.\n\n\n. . .\n\nO modelo é conhecido por ter taxas de falhas proporcionais. Este fato é conveniente na sua interpretação, ou seja, a razão das taxas de falha de dois indivíduos diferentes $i$ e $j$ é dada por\n\n\n$$\\dfrac{\\lambda_i(t)}{\\lambda_j(t)} = \\dfrac{\\exp(\\mathbf{x_i^t \\beta})}{\\exp(\\mathbf{x_j^t \\beta})} = \\exp(\\mathbf{x_i^t \\beta} - \\mathbf{x_j^t \\beta}),$$\nque não depende do tempo.\n\n\n. . .\n\nAssim, se um indivíduo no início do estudo tem um risco de morte igual a duas vezes o risco de um segundo indivíduo, entao esta razão de riscos será a mesma para todo o período de acompanhamento.\n\n\n## Hazard Ratio (HR)\n\n\nO Hazard Ratio (HR) é uma medida estatística amplamente utilizada em estudos de sobrevivência e análises de risco, especialmente em pesquisas médicas e epidemiológicas. \n\n. . .\n\n\nEm um modelo de Cox, a razão de risco (HR) é usada para medir o efeito de uma variável preditora no risco do evento. \n\n\n. . .\n\nÉ dada por\n\n$$HR = \\exp({\\beta_i}), i = 1, \\cdots, p,$$\nsendo $\\beta_i$ os coeficientes estimados do modelo de regressão de cox.\n\n## Hazard Ratio (HR)\n\n\nA HR representa o risco relativo do evento ocorrer para uma dada mudança de unidade na variável preditora, com uma $HR$ maior que 1 indicando um risco aumentado e uma $HR$ menor que 1 indicando um risco diminuído.\n\n\n\n\n# Exemplo \n\n## Descrição da base de dados\n\nO conjunto de dados contém casos de um estudo que foi conduzido entre 1958 e 1970 no Hospital Billings da Universidade de Chicago sobre a sobrevivência de pacientes que foram submetidos a cirurgia de mama. Os dados incluem:\n\n\n- Idade do paciente no momento da operação (numérico)\n- Ano da operação do paciente (ano - 1900, numérico)\n- Número de nódulos axilares positivos detectados (numérico)\n- Status de sobrevivência (dicotômica)\n    - 1 = o paciente sobreviveu 5 anos ou mais\n    - 2 = o paciente morreu em 5 anos\n\n\n## Preparação\n\n\n### Carregando os pacotes R\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(\ntidyverse,\nsurvival,\nsurvminer\n  ) \n```\n:::\n\n## Carregando os dados\n\n::: {.cell}\n\n```{.r .cell-code}\ndados = rio::import(\"https://raw.githubusercontent.com/tiagomartin/est104/refs/heads/master/dados/haberman.csv\")\n\ndados %>% \n  str()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t306 obs. of  4 variables:\n $ idade  : int  30 30 30 31 31 33 33 34 34 34 ...\n $ anoOper: int  64 62 65 59 65 58 60 59 66 58 ...\n $ numNod : int  1 3 0 2 4 10 0 0 9 30 ...\n $ status : int  1 1 1 1 1 1 1 2 2 1 ...\n```\n\n\n:::\n:::\n\n## Ajuste do modelo\n\n::: {.cell}\n\n```{.r .cell-code}\n# Ajustando o modelo de Cox\nmodelo_cox <- coxph(Surv(idade, status=='2') ~ ., data = dados)\n\n# Resumo do modelo\nsummary(modelo_cox)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\ncoxph(formula = Surv(idade, status == \"2\") ~ ., data = dados)\n\n  n= 306, number of events= 81 \n\n            coef exp(coef) se(coef)      z Pr(>|z|)    \nanoOper -0.02801   0.97238  0.03474 -0.806     0.42    \nnumNod   0.05517   1.05672  0.01009  5.469 4.52e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n        exp(coef) exp(-coef) lower .95 upper .95\nanoOper    0.9724     1.0284    0.9084     1.041\nnumNod     1.0567     0.9463    1.0360     1.078\n\nConcordance= 0.631  (se = 0.041 )\nLikelihood ratio test= 21.81  on 2 df,   p=2e-05\nWald test            = 30.08  on 2 df,   p=3e-07\nScore (logrank) test = 32.88  on 2 df,   p=7e-08\n```\n\n\n:::\n:::\n\n\n## Hazard Ratio (HR)\n\n::: {.cell}\n\n```{.r .cell-code}\nggforest(modelo_cox, data = dados)\n```\n\n::: {.cell-output-display}\n![](logistico_cox_files/figure-revealjs/unnamed-chunk-13-1.png){width=960}\n:::\n:::\n\n\n## Interpretação\n\nO ano da operação do paciente não tem relação significativa com o desfecho do paciente ($p-valor = 0,42 > 0,05$) ao nível de 5% de significância.\n\n. . .\n\nJá o número de nódulos axilares positivos detectados têm efeito significativo na sobrevida dos pacientes. Cada aumento de uma nódulo detectado foi associado um aumento médio de 5,67% no risco de mortalidade do paciente em 5 anos, após considerar outras covariáveis.\n\n. . .\n\nO IC de 95% para esse aumento ficou entre 3,6% e 7,8% ($p-valor << 0,001$)",
    "supporting": [
      "logistico_cox_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}